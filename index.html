<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Mona Piqueteadero</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Nuestros Productos</h1>
        </div>
        <div class="products-grid">
            <div class="product-card" data-product="salchipapa">
                <div class="product-image">üçü</div>
                <div class="product-name">Salchipapa Especial</div>
                <div class="product-price">$12.000 COP</div>
                <div class="quantity-control">
                    <button class="quantity-btn minus" data-product="salchipapa">-</button>
                    <span class="quantity-display" data-product="salchipapa">0</span>
                    <button class="quantity-btn plus" data-product="salchipapa">+</button>
                </div>
                <button class="add-to-cart-btn" data-product="salchipapa">Agregar al Carrito</button>
            </div>

            <div class="product-card" data-product="hamburguesa">
                <div class="product-image">üçî</div>
                <div class="product-name">Hamburguesa La Mona</div>
                <div class="product-price">$15.000 COP</div>
                <div class="quantity-control">
                    <button class="quantity-btn minus" data-product="hamburguesa">-</button>
                    <span class="quantity-display" data-product="hamburguesa">0</span>
                    <button class="quantity-btn plus" data-product="hamburguesa">+</button>
                </div>
                <button class="add-to-cart-btn" data-product="hamburguesa">Agregar al Carrito</button>
            </div>

            <div class="product-card" data-product="combo_familiar">
                <div class="product-image">üçΩÔ∏è</div>
                <div class="product-name">Combo Familiar</div>
                <div class="product-price">$35.000 COP</div>
                <div class="quantity-control">
                    <button class="quantity-btn minus" data-product="combo_familiar">-</button>
                    <span class="quantity-display" data-product="combo_familiar">0</span>
                    <button class="quantity-btn plus" data-product="combo_familiar">+</button>
                </div>
                <button class="add-to-cart-btn" data-product="combo_familiar">Agregar al Carrito</button>
            </div>

            <div class="product-card" data-product="alitas">
                <div class="product-image">üçó</div>
                <div class="product-name">Alitas BBQ</div>
                <div class="product-price">$18.000 COP</div>
                <div class="quantity-control">
                    <button class="quantity-btn minus" data-product="alitas">-</button>
                    <span class="quantity-display" data-product="alitas">0</span>
                    <button class="quantity-btn plus" data-product="alitas">+</button>
                </div>
                <button class="add-to-cart-btn" data-product="alitas">Agregar al Carrito</button>
            </div>

            <div class="product-card" data-product="perro_caliente">
                <div class="product-image">üå≠</div>
                <div class="product-name">Perro Caliente Especial</div>
                <div class="product-price">$10.000 COP</div>
                <div class="quantity-control">
                    <button class="quantity-btn minus" data-product="perro_caliente">-</button>
                    <span class="quantity-display" data-product="perro_caliente">0</span>
                    <button class="quantity-btn plus" data-product="perro_caliente">+</button>
                </div>
                <button class="add-to-cart-btn" data-product="perro_caliente">Agregar al Carrito</button>
            </div>

            <div class="product-card" data-product="combo_pareja">
                <div class="product-image">üíï</div>
                <div class="product-name">Combo Pareja</div>
                <div class="product-price">$25.000 COP</div>
                <div class="quantity-control">
                    <button class="quantity-btn minus" data-product="combo_pareja">-</button>
                    <span class="quantity-display" data-product="combo_pareja">0</span>
                    <button class="quantity-btn plus" data-product="combo_pareja">+</button>
                </div>
                <button class="add-to-cart-btn" data-product="combo_pareja">Agregar al Carrito</button>
            </div>
        </div>
    </div>

    <!-- Cart Summary -->
    <div class="cart-summary" id="cartSummary">
        <div class="cart-content">
            <div class="cart-info">
                <div class="cart-badge" id="cartBadge">0</div>
                <div class="cart-total" id="cartTotal">Total: $0 COP</div>
            </div>
            <div class="cart-actions">
                <button class="btn-secondary" onclick="clearCart()">Limpiar</button>
                <button class="btn-primary" onclick="showCheckoutModal()">Pagar</button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üõí Confirmar Pedido</h2>
                <span class="close" onclick="closeCheckoutModal()">&times;</span>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <div class="order-summary">
                <h3>Resumen del Pedido:</h3>
                <div id="orderDetails"></div>
                <div class="order-total" id="modalTotal"></div>
            </div>

            <div class="form-group">
                <label for="customerName">Nombre Completo: *</label>
                <input type="text" id="customerName" required>
            </div>

            <div class="form-group">
                <label for="customerPhone">Tel√©fono: *</label>
                <input type="tel" id="customerPhone" required>
            </div>

            <div class="form-group">
                <label for="customerEmail">Correo Electr√≥nico: *</label>
                <input type="email" id="customerEmail" required>
            </div>

            <div class="form-group">
                <label for="customerAddress">Direcci√≥n: *</label>
                <input type="text" id="customerAddress" required>
            </div>

            <div class="form-group">
                <label for="specialNotes">Notas especiales:</label>
                <textarea id="specialNotes" placeholder="Instrucciones especiales para tu pedido..."></textarea>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn-secondary" onclick="closeCheckoutModal()">Cancelar</button>
                <button class="btn-primary" onclick="processPayment()" id="payButton">üí≥ Confirmar Pedido</button>
            </div>
        </div>
    </div>

    <script>
        // Datos de productos
        const products = {
            salchipapa: { name: 'Salchipapa Especial', price: 12000 },
            hamburguesa: { name: 'Hamburguesa La Mona', price: 15000 },
            combo_familiar: { name: 'Combo Familiar', price: 35000 },
            alitas: { name: 'Alitas BBQ', price: 18000 },
            perro_caliente: { name: 'Perro Caliente Especial', price: 10000 },
            combo_pareja: { name: 'Combo Pareja', price: 25000 }
        };

        // Estado del carrito
        let cart = {};

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateCartDisplay();
        });

        function setupEventListeners() {
            // Botones de cantidad
            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.dataset.product;
                    const isPlus = this.classList.contains('plus');
                    
                    if (isPlus) {
                        increaseQuantity(productId);
                    } else {
                        decreaseQuantity(productId);
                    }
                });
            });

            // Botones agregar al carrito
            document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.dataset.product;
                    addToCart(productId);
                });
            });
        }

        function increaseQuantity(productId) {
            const display = document.querySelector(`[data-product="${productId}"].quantity-display`);
            let quantity = parseInt(display.textContent) + 1;
            display.textContent = quantity;
            
            // Auto-agregar al carrito cuando la cantidad es >= 1
            if (quantity >= 1) {
                cart[productId] = quantity;
                updateCartDisplay();
            }
        }

        function decreaseQuantity(productId) {
            const display = document.querySelector(`[data-product="${productId}"].quantity-display`);
            let quantity = Math.max(0, parseInt(display.textContent) - 1);
            display.textContent = quantity;
            
            if (quantity === 0) {
                delete cart[productId];
            } else {
                cart[productId] = quantity;
            }
            updateCartDisplay();
        }

        function addToCart(productId) {
            const display = document.querySelector(`[data-product="${productId}"].quantity-display`);
            const quantity = parseInt(display.textContent);
            
            if (quantity > 0) {
                cart[productId] = quantity;
                updateCartDisplay();
                showSuccessAnimation(productId);
            }
        }

        function showSuccessAnimation(productId) {
            const btn = document.querySelector(`[data-product="${productId}"].add-to-cart-btn`);
            const originalText = btn.textContent;
            btn.textContent = '‚úì Agregado';
            btn.style.background = '#28a745';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '#ffc107';
            }, 1000);
        }

        function updateCartDisplay() {
            const cartSummary = document.getElementById('cartSummary');
            const cartBadge = document.getElementById('cartBadge');
            const cartTotal = document.getElementById('cartTotal');
            
            let totalItems = 0;
            let totalPrice = 0;
            
            Object.keys(cart).forEach(productId => {
                const quantity = cart[productId];
                const price = products[productId].price;
                totalItems += quantity;
                totalPrice += quantity * price;
            });
            
            cartBadge.textContent = totalItems;
            cartTotal.textContent = `Total: $${totalPrice.toLocaleString()} COP`;
            
            if (totalItems > 0) {
                cartSummary.classList.add('active');
            } else {
                cartSummary.classList.remove('active');
            }
        }

        function clearCart() {
            cart = {};
            // Resetear todas las cantidades en pantalla
            document.querySelectorAll('.quantity-display').forEach(display => {
                display.textContent = '0';
            });
            updateCartDisplay();
        }

        function showCheckoutModal() {
            if (Object.keys(cart).length === 0) {
                alert('Tu carrito est√° vac√≠o');
                return;
            }
            
            const modal = document.getElementById('checkoutModal');
            const orderDetails = document.getElementById('orderDetails');
            const modalTotal = document.getElementById('modalTotal');
            
            // Generar resumen del pedido
            let html = '';
            let total = 0;
            
            Object.keys(cart).forEach(productId => {
                const product = products[productId];
                const quantity = cart[productId];
                const subtotal = product.price * quantity;
                total += subtotal;
                
                html += `
                    <div class="order-item">
                        <span>${product.name} x${quantity}</span>
                        <span>$${subtotal.toLocaleString()} COP</span>
                    </div>
                `;
            });
            
            orderDetails.innerHTML = html;
            modalTotal.textContent = `Total: $${total.toLocaleString()} COP`;
            
            modal.style.display = 'block';
        }

        function closeCheckoutModal() {
            const modal = document.getElementById('checkoutModal');
            modal.style.display = 'none';
            clearMessages();
        }

        function clearMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
        }

        async function processPayment() {
            clearMessages();
            
            // Validar formulario
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            const address = document.getElementById('customerAddress').value.trim();
            const notes = document.getElementById('specialNotes').value.trim();
            
            if (!name || !phone || !email || !address) {
                showError('Por favor completa todos los campos obligatorios');
                return;
            }
            
            // Crear objeto del pedido
            const orderData = {
                cliente_nombre: name,
                cliente_telefono: phone,
                cliente_email: email,
                cliente_direccion: address,
                notas_especiales: notes,
                items: Object.keys(cart).map(productId => ({
                    producto: products[productId].name,
                    cantidad: cart[productId],
                    precio_unitario: products[productId].price,
                    subtotal: cart[productId] * products[productId].price
                })),
                total: Object.keys(cart).reduce((sum, productId) => 
                    sum + (cart[productId] * products[productId].price), 0
                ),
                fecha: new Date().toISOString()
            };
            
            // Deshabilitar bot√≥n durante el proceso
            const payButton = document.getElementById('payButton');
            const originalText = payButton.textContent;
            payButton.disabled = true;
            payButton.textContent = 'Procesando...';
            
            try {
                console.log('Enviando pedido:', orderData);
                
                // Intentar enviar a la API
                const response = await fetch('/api/pedidos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSuccess('¬°Pedido enviado exitosamente! Te contactaremos pronto.');
                    setTimeout(() => {
                        clearCart();
                        closeCheckoutModal();
                    }, 2000);
                } else {
                    throw new Error(`Error del servidor: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Error al procesar el pedido:', error);
                
                // Fallback: redirigir a WhatsApp
                const whatsappMessage = createWhatsAppMessage(orderData);
                const whatsappUrl = `https://wa.me/573210000000?text=${encodeURIComponent(whatsappMessage)}`;
                
                showError('Error en el sistema. Redirigiendo a WhatsApp...');
                setTimeout(() => {
                    window.open(whatsappUrl, '_blank');
                    clearCart();
                    closeCheckoutModal();
                }, 2000);
            }
            
            // Rehabilitar bot√≥n
            payButton.disabled = false;
            payButton.textContent = originalText;
        }

        function createWhatsAppMessage(orderData) {
            let message = `üçΩÔ∏è *NUEVO PEDIDO - LA MONA PIQUETEADERO*\n\n`;
            message += `üë§ *Cliente:* ${orderData.cliente_nombre}\n`;
            message += `üì± *Tel√©fono:* ${orderData.cliente_telefono}\n`;
            message += `üìß *Email:* ${orderData.cliente_email}\n`;
            message += `üìç *Direcci√≥n:* ${orderData.cliente_direccion}\n\n`;
            
            message += `üìã *PRODUCTOS:*\n`;
            orderData.items.forEach(item => {
                message += `‚Ä¢ ${item.producto} x${item.cantidad} - $${item.subtotal.toLocaleString()} COP\n`;
            });
            
            message += `\nüí∞ *TOTAL: $${orderData.total.toLocaleString()} COP*\n`;
            
            if (orderData.notas_especiales) {
                message += `\nüìù *Notas especiales:* ${orderData.notas_especiales}\n`;
            }
            
            message += `\n‚è∞ *Fecha:* ${new Date().toLocaleString('es-CO')}`;
            
            return message;
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            const modal = document.getElementById('checkoutModal');
            if (event.target == modal) {
                closeCheckoutModal();
            }
        }
    </script>
</body>
</html>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'GA_MEASUREMENT_ID');
</script>